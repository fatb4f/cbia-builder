flowchart TD
  %% =========================================================
  %% GPT-EXECUTED PIPELINE (Scripts are reference/contract only)
  %% Track: INF1220 | Slice: TP1
  %% =========================================================

  A0[MODE: GPT_EXECUTION\nScripts = reference contract] --> A1[Bind Authority Sources\n(cbia-content/inf1220/syllabus/**\nincludes Java manual)]
  A1 --> A2[Set Scope\nTP1-only objective authority\nbounded regen scope]
  A2 --> A3[Arm Review Gate\nSyllabus-inferred but unassessed => buffer\n(no promotion without review decision)]

  %% -------- Objective Discovery (Operator) --------
  A3 --> B0[GEN-TP1-EXTRACT (GPT)\nExtract candidate TP1 objectives\nOutput: tp1.extracted.gpt.json]
  B0 --> B1[STRUCT-MATERIALIZE-EVIDENCE (Trusted)\nResolve evidence pointers -> quotes/locators/hashes\nOutput: tp1.extracted.json]
  B1 --> B2[MAP-SYLLABUS (GPT)\nMap TP1 objectives to syllabus elements\nTag: derived vs inferred]
  B2 --> B3[COLLECT-UNPROMOTED (GPT)\nList syllabus items not promoted\nOutput: review.syllabus_unpromoted.json]
  B3 --> B4[NEAREST-NEIGHBOR (GPT)\nUnpromoted -> closest TP1 objective\nOutput: review.unpromoted.closest.json]

  %% -------- Depth Halo (Controlled Elaboration) --------
  B4 --> C0[HALO-ANNOTATE (GPT)\nAttach halos to TP1 objectives\n(non-promoting)]
  C0 --> C1[STRUCT-HALO (Trusted)\nValidate halo policy: reference-only\nOutput: depth_halo.json]

  %% -------- TP1 Material (Operator) --------
  C1 --> D0[GEN-TP1-MATERIAL (GPT)\nGenerate theory/drills using halos as optional examples]
  D0 --> D1[STRUCT-MATERIAL (Trusted)\nReject if drills require halo knowledge\nReject scope creep]
  D1 --> D2[FLOW+EVAL (Trusted)\nOrder, coverage, reports\nOutput: flow/eval/manifest]

  %% -------- Ops packaging --------
  D2 --> E0[OPS-READINESS CHECK\n(agents.md + kernel notes + DAG pointers)]
